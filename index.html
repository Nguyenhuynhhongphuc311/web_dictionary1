<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ª´ ƒêi·ªÉn Anh - Vi·ªát</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- C·∫•u h√¨nh font Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9; /* N·ªÅn s√°ng nh·∫π */
        }
        /* Style cho t·ª´ kh√≥a ƒë∆∞·ª£c highlight, s·ª≠ d·ª•ng <mark> */
        mark {
            background-color: #fce38a; /* M√†u v√†ng nh·∫°t n·ªïi b·∫≠t */
            color: #111827; /* M√†u ch·ªØ ƒëen ƒë·∫≠m */
            font-weight: 600;
            padding: 1px 3px;
            border-radius: 4px;
        }
        /* Style cho link t·ª´ kh√≥a trong c√¢u v√≠ d·ª• */
        .example a {
            color: #2563eb; /* M√†u xanh d∆∞∆°ng ƒë·∫≠m */
            text-decoration: none;
            font-weight: 600;
        }
        .example a:hover {
            text-decoration: underline;
        }
        /* ƒê·∫£m b·∫£o hi·ªÉn th·ªã phi√™n √¢m r√µ r√†ng */
        .pronunciation {
            font-family: 'Times New Roman', 'Arial', monospace;
            font-size: 1.25rem; /* text-xl */
            color: #4b5563;
            font-style: italic;
            font-weight: 500;
            margin-left: 0.5rem;
        }
        .pronunciation.missing {
            color: #b91c1c; /* M√†u ƒë·ªè c·∫£nh b√°o */
            font-size: 0.875rem; /* text-sm */
            font-style: italic;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2">
                üìò T·ª´ ƒêi·ªÉn Anh - Vi·ªát
            </h1>
            <p class="text-lg text-gray-600">Tra c·ª©u t·ª´ v·ª±ng, ng·ªØ ph√°p v√† phi√™n √¢m</p>
        </header>

        <!-- Search Form -->
        <!-- ƒê√£ th√™m position relative v√†o form ƒë·ªÉ g·ª£i √Ω n·∫±m trong ph·∫°m vi, d·ªÖ d√†ng cƒÉn ch·ªânh -->
        <form method="GET" id="searchForm" class="mb-10 shadow-xl rounded-full bg-white flex p-1 relative z-20">
            <input 
                type="search" 
                name="word" 
                id="wordInput"
                placeholder="Nh·∫≠p t·ª´ c·∫ßn tra c·ª©u (v√≠ d·ª•: abandon, ability...)"
                value="{{ search_word if search_word }}"
                class="w-full py-4 px-6 text-lg rounded-l-full focus:outline-none border-0 bg-transparent"
                required
                autocomplete="off"
            >
            <button 
                type="submit"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full transition duration-300 flex items-center justify-center m-1 shadow-md"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </button>
            
            <!-- Container cho g·ª£i √Ω t·ª± ƒë·ªông (N·∫±m ngo√†i input v√† button, nh∆∞ng b√™n trong form ƒë·ªÉ d·ªÖ cƒÉn ch·ªânh) -->
            <!-- V·ªã tr√≠ tuy·ªát ƒë·ªëi so v·ªõi form cha (relative) -->
            <div id="suggestionsBox" class="absolute top-full w-[calc(100%-8px)] mt-1 ml-1 bg-white shadow-2xl rounded-xl z-10 hidden border border-gray-200">
                <!-- G·ª£i √Ω s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
            </div>
        </form>

        <!-- K·∫øt Qu·∫£ T√¨m Ki·∫øm -->
        <main id="results-container" class="mt-8">
            {% if search_word and results|length == 0 %}
                <!-- Kh√¥ng c√≥ k·∫øt qu·∫£ -->
                <div class="text-center p-8 bg-white rounded-xl shadow-lg border-l-4 border-yellow-500">
                    <p class="text-xl text-gray-700">Kh√¥ng t√¨m th·∫•y t·ª´ <span class="font-bold text-red-500">"{{ search_word }}"</span> n√†o. üßê</p>
                    <p class="text-md text-gray-500 mt-2">H√£y th·ª≠ t√¨m ki·∫øm v·ªõi m·ªôt t·ª´ kh√°c!</p>
                </div>
            {% elif results %}
                <!-- Hi·ªÉn th·ªã k·∫øt qu·∫£ -->
                {% for r in results %}
                <!-- r = [word(0), pronunciation(1), type(2), v2(3), v3(4), ing(5), ed(6), meaning(7), example(8), synonym(9), antonym(10)] -->
                <div class="word-card p-6 bg-white rounded-2xl shadow-lg mb-6 hover:shadow-xl transition-shadow duration-300 border-l-6 border-blue-600">
                    
                    <!-- 1. T·ª´ V·ª±ng & Phi√™n √Çm & Ph√°t √¢m -->
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex flex-col sm:flex-row sm:items-baseline">
                            <!-- T·ª´ V·ª±ng -->
                            <h2 class="text-3xl font-extrabold text-gray-800 mr-4 leading-tight">
                                <span class="{% if r[0]|lower == search_word|lower %}mark{% endif %}">
                                    {{ r[0] | safe }}
                                </span>
                            </h2>
                            <!-- Phi√™n √Çm -->
                            {% if r[1] %}
                                <span class="pronunciation mt-1 sm:mt-0">/{{ r[1] | safe }}/</span>
                            {% else %}
                                <span class="pronunciation missing mt-1 sm:mt-0">Thi·∫øu phi√™n √¢m</span>
                            {% endif %}
                        </div>
                        
                        <!-- N√∫t Ph√°t √Çm -->
                        <button class="speak-btn text-blue-600 hover:text-blue-700 text-3xl transition duration-200 p-2 rounded-full hover:bg-gray-100" 
                                onclick="speakWord('{{ r[0] }}')">
                            üîä
                        </button>
                    </div>

                    <!-- 2. Lo·∫°i T·ª´ -->
                    {% if r[2] %}
                    <p class="text-lg text-blue-600 font-semibold mb-3">
                        <span class="inline-block bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full uppercase font-bold tracking-wider">{{ r[2] }}</span>
                    </p>
                    {% endif %}

                    <!-- 3. C√°c D·∫°ng Kh√°c (Ch·ªâ hi·ªÉn th·ªã cho ƒë·ªông t·ª´, n·∫øu c√≥) -->
                    {% if r[3] or r[4] or r[5] or r[6] %}
                    <div class="flex flex-wrap gap-x-4 text-gray-600 text-sm mb-3">
                        {% if r[3] %}<b>V2:</b> {{ r[3] }} &nbsp;{% endif %}
                        {% if r[4] %}<b>V3:</b> {{ r[4] }} &nbsp;{% endif %}
                        {% if r[5] %}<b>V-ing:</b> {{ r[5] }} &nbsp;{% endif %}
                        {% if r[6] %}<b>V-ed:</b> {{ r[6] }}{% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- 4. Nghƒ©a -->
                    <div class="text-xl font-medium text-gray-800 border-t pt-3 mt-3 border-gray-100">
                        <span class="text-gray-500 font-bold mr-2">Nghƒ©a:</span> {{ r[7] | safe }}
                    </div>

                    <!-- 5. V√≠ d·ª• -->
                    {% if r[8] %}
                        <div class="example text-gray-600 italic mt-3 text-base">
                            üí¨ <span class="font-bold text-gray-700 not-italic">V√≠ d·ª•:</span> {{ r[8]|safe }}
                        </div>
                    {% endif %}

                    <!-- 6. T·ª´ ƒë·ªìng nghƒ©a & tr√°i nghƒ©a -->
                    <div class="flex flex-wrap gap-4 mt-4">
                        <div class="synonym bg-green-50 text-green-700 p-3 rounded-xl flex-1 min-w-[250px] shadow-sm">
                            <span class="font-bold mr-1">üîπ ƒê·ªìng nghƒ©a:</span> {{ r[9] if r[9] and r[9] != 'None' else 'Ch∆∞a c√≥' }}
                        </div>
                        <div class="antonym bg-red-50 text-red-700 p-3 rounded-xl flex-1 min-w-[250px] shadow-sm">
                            <span class="font-bold mr-1">üî∏ Tr√°i nghƒ©a:</span> {{ r[10] if r[10] and r[10] != 'None' else 'Ch∆∞a c√≥' }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- Trang m·∫∑c ƒë·ªãnh -->
                <div class="text-center p-8 bg-white rounded-xl shadow-lg border-l-4 border-blue-600">
                    <p class="text-xl text-gray-700">Ch√†o m·ª´ng, h√£y nh·∫≠p t·ª´ c·∫ßn tra c·ª©u v√†o √¥ t√¨m ki·∫øm b√™n tr√™n! üöÄ</p>
                </div>
            {% endif %}
        </main>
    </div>

<script>
// Khai b√°o h√†m ph√°t √¢m
function speakWord(text) {
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 0.9;
        speechSynthesis.speak(utterance);
    } else { 
        console.warn("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ gi·ªçng n√≥i."); 
    }
}

const input = document.getElementById('wordInput');
const suggestionsBox = document.getElementById('suggestionsBox');
let debounceTimer;

input.addEventListener('input', function() {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
        const term = input.value.trim();
        if (term.length < 1) { 
            suggestionsBox.style.display = 'none'; 
            return; 
        }
        
        // S·ª¨ D·ª§NG AJAX (fetch) ƒë·ªÉ l·∫•y g·ª£i √Ω t·ª´ Flask
        fetch(`/autocomplete?term=${term}`)
            .then(res => res.json())
            .then(data => {
                if (data.length > 0) {
                    // C·∫≠p nh·∫≠t l·∫°i HTML c·ªßa suggestionsBox
                    suggestionsBox.innerHTML = data.map(word => 
                        // S·ª≠ d·ª•ng class Tailwind cho c√°c m·ª•c g·ª£i √Ω
                        `<div onclick="selectSuggestion('${word.replace(/'/g, "\\'")}')" 
                             class="px-6 py-3 cursor-pointer text-gray-700 hover:bg-blue-50 transition-colors duration-150 rounded-lg m-1">
                            ${word}
                        </div>`
                    ).join('');
                    suggestionsBox.style.display = 'block';
                } else { 
                    suggestionsBox.style.display = 'none'; 
                }
            })
            .catch(error => {
                console.error('L·ªói khi fetch autocomplete:', error);
                suggestionsBox.style.display = 'none';
            });
    }, 250); // Debounce 250ms
});

function selectSuggestion(word) {
    input.value = word;
    suggestionsBox.style.display = 'none';
    // ƒêi·ªÅu h∆∞·ªõng th·∫≥ng t·ªõi link tra c·ª©u
    window.location.href = `/?word=${encodeURIComponent(word)}`; 
}

// üîó Click t·ª´ trong v√≠ d·ª•
document.addEventListener('click', function(e) {
    // X·ª≠ l√Ω link t·ª´ trong c√¢u v√≠ d·ª•
    if (e.target.tagName === 'A') {
        // Ki·ªÉm tra xem li√™n k·∫øt c√≥ ph·∫£i l√† link tra t·ª´ c·ªßa ch√∫ng ta kh√¥ng (b·∫Øt ƒë·∫ßu b·∫±ng /?word=)
        const href = e.target.getAttribute('href');
        if (href && href.startsWith('/?word=')) {
            e.preventDefault();
            // ƒêi·ªÅu h∆∞·ªõng th·∫≥ng t·ªõi link tra c·ª©u
            window.location.href = href;
        }
    }
    
    // ƒê√≥ng box g·ª£i √Ω khi click ra ngo√†i
    const searchForm = document.getElementById('searchForm');
    if (!searchForm.contains(e.target)) {
        suggestionsBox.style.display = 'none';
    }
});

// X·ª≠ l√Ω khi nh·∫•n Enter tr√™n input ƒë·ªÉ ƒë·∫£m b·∫£o g·ª≠i form
input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh v√† submit form
        e.preventDefault();
        document.getElementById('searchForm').submit();
    }
});

// ƒê·∫£m b·∫£o thanh g·ª£i √Ω kh√¥ng b·ªã l·ªói khi resize
window.addEventListener('resize', () => {
    if (suggestionsBox.style.display === 'block') {
        // Khi resize, ·∫©n ƒëi ƒë·ªÉ tr√°nh hi·ªÉn th·ªã sai l·ªách
        suggestionsBox.style.display = 'none';
    }
});
</script>
</body>
</html>
